#!/usr/local/bin/coffee
# another comment

fs = require 'fs'

p = require './lib/ascent-0.0.2'
chuck = require './src/chuck'

main = (argv) ->
  if !argv[1]?
    console.error "Usage: #{argv[0]} FILE [ FILE ... ]"
    return

  classes = []

  for file in argv.slice 1
    name = file.match(/\/([^\/]+)\.(cls|trigger)$/)?[1]
    continue unless name
    cls = fs.readFileSync(file).toString()
    console.error "now parsing #{name}"
    try
      results = chuck.analyze p.parse cls
      results.name = name
      classes.push results
    catch err
      classes.push { name: name, error: "#{err}" }
      console.error "File #{file}: #{err}\n"

  console.log JSON.stringify classes, null, 2

main process.argv.slice 1
